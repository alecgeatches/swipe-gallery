!function(){"use strict";var e={n:function(t){var l=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(l,{a:l}),l},d:function(t,l){for(var a in l)e.o(l,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:l[a]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t=window.wp.blocks,l=JSON.parse('{"apiVersion":2,"name":"alecg/swipe-gallery","title":"Swipe Gallery","icon":"screenoptions","category":"media","editorScript":"alecg-swipe-gallery-editor","editorStyle":"file:./css/editor.css","style":"file:./css/frontend.css","attributes":{"images":{"type":"array","default":[]}}}');function a(){return a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var l=arguments[t];for(var a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a])}return e},a.apply(this,arguments)}var r=window.wp.element,i=window.wp.i18n,n=window.wp.blockEditor,s=window.wp.primitives,o=window.lodash,c=e.n(o),d=window.wp.compose,m=window.jQuery,u=e.n(m),p=e=>{const{items:t,onItemsChange:l,children:a,isDisabled:i=!1}=e,n=(0,r.useRef)(),s=(0,d.useRefEffect)((e=>{const t=u()(e).sortable({cursor:"grabbing",tolerance:"pointer",classes:{"ui-sortable-disabled":"sortable-gallery-disabled","ui-sortable-helper":"item-dragged","ui-sortable-placeholder":"sortable-gallery-item"},placeholder:"item-placeholder"});return console.log("Set up sortable"),()=>{t.sortable("destroy")}}),[]),o=(0,d.useMergeRefs)([n,s]);return(0,r.useEffect)((()=>{if(void 0===n.current)return;const e=u()(n.current);e.sortable("option","stop",((a,r)=>{const i=[...r.item.get(0).parentElement.children].map((e=>e.dataset.id)).map((e=>t[e]));e.sortable("cancel"),l(i)}))}),[t]),(0,r.useEffect)((()=>{n.current&&u()(n.current).sortable("option","disabled",i)}),[i]),0===t.length?null:(0,r.createElement)("div",{className:"sortable-gallery sortable-gallery-last-row-"+t.length%4,ref:o},a.map(((e,a)=>(e.props.onRemoveClick=()=>function(e){const a=[...t.slice(0,e),...t.slice(e+1)];l(a)}(a),(0,r.createElement)("div",{className:"sortable-gallery-item",key:a,"data-id":a},e)))))},g=window.wp.components,w=e=>{const[t,l]=(0,r.useState)(!1),{image:n,index:s,onRemoveClick:o}=e,c={"data-id":s};return 0!==n.url.indexOf("blob:")||n.id?(0,r.createElement)("figure",a({className:"swipe-gallery-item swipe-gallery-item-loaded"},c),(0,r.createElement)("img",{src:n.url}),(0,r.createElement)("button",{className:"swipe-gallery-item-remove",title:(0,i.__)("Remove Image","alecg-swipe-gallery"),onClick:()=>l(!0)},(0,r.createElement)("span",{class:"dashicons dashicons-no-alt"})),t&&(0,r.createElement)(g.Modal,{className:"swipe-gallery-item-remove-modal",title:(0,i.__)("Remove image from gallery?","alecg-swipe-gallery"),onRequestClose:()=>l(!1)},(0,r.createElement)(g.Button,{variant:"primary",onClick:()=>(l(!1),void o(s))},(0,i.__)("Remove","alecg-swipe-gallery")),(0,r.createElement)(g.Button,{onClick:()=>l(!1)},(0,i.__)("Cancel","alecg-swipe-gallery")))):(0,r.createElement)("figure",a({className:"swipe-gallery-item swipe-gallery-item-loading"},c),(0,r.createElement)("img",{src:n.url}),(0,r.createElement)(g.Spinner,null))};const{name:y}=l;(0,t.registerBlockType)(y,{edit:e=>{var t;const{attributes:l,setAttributes:o,isSelected:d}=e,m=(0,n.useBlockProps)(),[u,g]=(0,r.useState)(null!==(t=l.images)&&void 0!==t?t:[]);function y(e){return 0===e.url.indexOf("blob:")&&!e.id}(0,r.useEffect)((()=>{const e=u.filter((e=>!y(e)));o({images:e})}),[u]);const f={allowedTypes:["image"],multiple:!0,onSelect:function(e){const t=c().uniqBy([...u,...e],(e=>e.id?e.id:e.url)).map((e=>({id:e.id,url:e.url})));g(t)}};if(0===u.length)return(0,r.createElement)(s.View,m,(0,r.createElement)(n.MediaPlaceholder,a({},f,{labels:{title:(0,i.__)("Swipe Gallery","alecg-swipe-gallery"),instructions:(0,i.__)("Drag, upload, or select images to be displayed in the gallery.","alecg-swipe-gallery")}})));{const e=u.some(y);return(0,r.createElement)(s.View,m,(0,r.createElement)(p,{items:u,onItemsChange:function(e){g(e)},isDisabled:e},u.map((e=>(0,r.createElement)(w,{image:e})))),!d&&!e&&(0,r.createElement)("p",{className:"swipe-gallery-upload-text"},(0,i.__)("Add to swipe gallery...","alecg-swipe-gallery")),d&&!e&&(0,r.createElement)(n.MediaPlaceholder,a({},f,{className:"swipe-gallery-append-media-placeholder",isAppender:!0,labels:{instructions:!1,title:!1}})))}},save:e=>{var t;const l=n.useBlockProps.save(),{attributes:a}=e,i=null!==(t=a.images)&&void 0!==t?t:[];return(0,r.createElement)(s.View,l,(0,r.createElement)("ul",null,i.map((e=>(0,r.createElement)("li",null,(0,r.createElement)("div",{class:"swipe-gallery-media-item","data-id":e.id},e.id))))))}})}();